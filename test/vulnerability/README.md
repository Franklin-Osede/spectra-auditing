# Price Manipulation Vulnerability in RateAdjustmentOracle

This directory contains tests demonstrating a critical vulnerability in the `RateAdjustmentOracle` contract, which obtains the PT value directly from the Curve StableSwap NG pool without mechanisms to protect against price manipulation.

## Vulnerability Description

The `RateAdjustmentOracle.value()` function reads the PT rate directly from the Curve StableSwap NG pool without any manipulation protection. This design creates a vulnerability as follows:

1. The oracle obtains the PT value directly by calling `getPTRate()` on the Principal Token contract, which returns the current rate from the pool
2. There are no TWAP (Time-Weighted Average Price) mechanisms, manipulation checks, or validation of the returned values
3. This makes the oracle vulnerable to flash loan attacks where an attacker can temporarily manipulate the price in the pool

## Attack Vector

An attacker can execute the following steps:

1. Take a flash loan to borrow a large amount of IBT tokens
2. Execute a large swap in the Curve Pool to manipulate the PT price
3. Trigger operations that depend on the manipulated oracle value
4. Reverse the manipulation and repay the flash loan

The test demonstrates how significant price manipulation can be achieved with a large swap.

## Impact

This vulnerability can lead to:

- Incorrect valuation of PTs in protocols that rely on this oracle
- Potential over-borrowing in lending protocols
- Price manipulation for liquidations
- Theft of funds through various price-dependent mechanisms

## Test Explanation

The `RateAdjustmentOracleManipulation.t.sol` file contains two tests:

1. `testOraclePriceManipulation`: Demonstrates how a large swap can significantly impact the oracle's reported value
2. `testExploitScenario`: Shows how an attacker could profit from this manipulation in a lending scenario

## Mitigation

To fix this vulnerability, consider implementing:

1. Time-Weighted Average Price (TWAP) mechanism
2. Multiple price sources and using median values
3. Price deviation bounds to detect and reject manipulated values
4. Circuit breakers that trigger during suspicious price movements

The safest approach would be to implement a combination of these methods to provide robust protection against price manipulation attacks. 